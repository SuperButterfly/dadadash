(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[11],{20:function(t,e){},c518:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-page-container",[n("q-page",[n("div",{staticClass:"row q-pa-md q-gutter-sm"},[n("div",{staticClass:"col-6"},[n("q-input",{attrs:{"clear-icon":"fas fa-times",label:"Search"},model:{value:t.actionFilter,callback:function(e){t.actionFilter=e},expression:"actionFilter"}})],1),n("div",{staticClass:"col-4"},[n("q-btn",{attrs:{fab:"",icon:"add",color:"primary"},on:{click:function(e){return t.showCreateAction()}}})],1),n("div",{staticClass:"col-12"},[n("q-markup-table",{attrs:{flat:""}},[n("thead",[n("tr",{staticClass:"text-left"},[n("th",[t._v("Name")]),n("th",[t._v("# Input fields")]),n("th",[t._v("# Output fields")]),n("th")])]),n("tbody",t._l(t.filteredActions,(function(e){return n("tr",[n("td",[t._v(t._s(e.ActionSchema.Label)+" on "+t._s(e.ActionSchema.OnType))]),n("td",[t._v(t._s(e.ActionSchema.InFields?e.ActionSchema.InFields.length:0))]),n("td",[t._v(t._s(e.ActionSchema.OutFields?e.ActionSchema.OutFields.length:0))]),n("td",{staticClass:"text-right"},[n("q-btn",{staticClass:"float-right",attrs:{size:"sm",label:"Edit action"},on:{click:function(n){return t.showEditAction(e)}}})],1)])})),0)])],1)]),n("q-drawer",{attrs:{overlay:"",width:400,side:"right"},model:{value:t.showCreateActionDrawer,callback:function(e){t.showCreateActionDrawer=e},expression:"showCreateActionDrawer"}},[n("q-scroll-area",{staticClass:"fit row"},[n("q-card",[n("q-card-section",[n("span",{staticClass:"text-h6"},[t._v("Create action")])]),n("q-card-section",[n("q-form",{staticClass:"q-gutter-md"},[n("textarea",{attrs:{id:"actionSchemaEditor"}})])],1),n("q-card-actions",{attrs:{align:"right"}},[n("q-btn",{on:{click:function(e){t.showCreateActionDrawer=!1}}},[t._v("Cancel")]),n("q-btn",{staticClass:"float-right",attrs:{color:"primary"},on:{click:function(e){return t.createAction()}}},[t._v("Create")])],1)],1)],1)],1),n("q-drawer",{attrs:{overlay:"","content-class":"bg-grey-3",width:400,side:"right"},model:{value:t.showEditActionDrawer,callback:function(e){t.showEditActionDrawer=e},expression:"showEditActionDrawer"}},[n("q-scroll-area",{staticClass:"fit row"},[n("div",{staticClass:"q-pa-md"},[n("span",{staticClass:"text-h6"},[t._v("Edit action")]),n("q-form",{staticClass:"q-gutter-md"},[n("q-btn",{attrs:{color:"negative"},on:{click:function(e){return t.deleteAction()}}},[t._v("Delete")]),n("q-btn",{staticClass:"float-right",on:{click:function(e){t.showEditActionDrawer=!1}}},[t._v("Cancel")])],1)],1)])],1)],1)],1)},i=[],o=(n("8e6e"),n("8a81"),n("ac6a"),n("cadf"),n("06db"),n("456d"),n("c47a")),c=n.n(o),s=n("2f62"),r=(n("b116"),n("ebfb")),l=n.n(r);function d(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function f(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?d(Object(n),!0).forEach((function(e){c()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var h=n("651e"),u={name:"ActionPage",methods:f(f({showCreateAction:function(){var t=this;t.showCreateActionDrawer=!0,setTimeout((function(){t.actionSchemaEditor&&t.actionSchemaEditor.toTextArea&&t.actionSchemaEditor.toTextArea(),t.actionSchemaEditor=new l.a({element:document.getElementById("actionSchemaEditor"),toolbar:[]}),t.actionSchemaEditor.value("---\nName: my_new_action\nLabel: New Action Button Label\nOnType: user_account\nInstanceOptional: false\nInFields:\nOutFields:")}),400)},showEditAction:function(t){console.log("Edit action",t),this.setSelectedActionForEditor(t),this.$router.push("/integrations/action/"+t.ActionSchema.OnType+"/"+t.action_name)},deleteAction:function(){var t=this;console.log("Delete action",this.selectedAction),this.deleteRow({tableName:"action",reference_id:this.selectedAction.id}).then((function(e){t.showEditActionDrawer=!1,t.selectedAction={},t.$q.notify({title:"Success",message:"Action deleted"}),t.refresh()})).catch((function(e){t.$q.notify({title:"Failed",message:JSON.stringify(e)})}))},editAction:function(){var t=this;console.log("Delete action",this.selectedAction),this.newAction.tableName="action",this.newAction.id=this.selectedAction.id,this.updateRow(this.newAction).then((function(e){t.showEditActionDrawer=!1,t.selectedAction={},t.$q.notify({title:"Success",message:"Action updated"}),t.refresh()})).catch((function(e){t.$q.notify({title:"Failed",message:JSON.stringify(e)})}))},createAction:function(){var t=this,e=t.actionSchemaEditor.value();console.log("new action",t.allTables,e);var n={};try{if(n=h.load(e),console.log("Yaml spec",n),!n)return void t.$q.notify({message:"Invalid spec, not valid YAML"})}catch(i){return void t.$q.notify({message:"Invalid spec, not valid YAML"})}this.newAction.action_name=n.Name;var a=t.allTables.filter((function(t){return t.table_name===n.OnType}))[0];console.log("target table",a),this.newAction.label=n.Label,this.newAction.ActionSchema=JSON.stringify(n),this.newAction.tableName="action",this.newAction.world_id={type:"world",id:a.id},console.log("New action",this.newAction),t.createRow(t.newAction).then((function(e){t.user={},t.$q.notify({message:"action action created"}),t.refresh(),t.showCreateActionDrawer=!1})).catch((function(e){e instanceof Array?t.$q.notify({message:e[0].title}):t.$q.notify({message:"Failed to create action"})}))}},Object(s["b"])(["loadData","getTableSchema","refreshTables","createRow","deleteRow","refreshActions","updateRow","executeAction","setSelectedActionForEditor"])),{},{refresh:function(){var t=this;t.refreshTables().then((function(){console.log("Loaded tabled"),t.localTables=t.allTables.sort((function(t,e){return t.table_name>e.table_name}))})).catch((function(t){console.log("Failed to refresh tables",t)})),this.refreshActions().then((function(){console.log("actions loaded")}))}}),data:function(){return f({text:"",localTables:[],actionSchemaEditor:null,actionFilter:null,selectedAction:{},actionProviderOptions:[{icon:"fas fa-aws",label:"Amazon Drive",description:"OAuth token based"},{icon:"fas fa-aws",label:"Amazon S3",description:"OAuth token based"},{icon:"fas fa-aws",label:"Backblaze B2",description:"OAuth token based"},{icon:"fas fa-aws",label:"Dropbox",description:"OAuth token based"},{icon:"fas fa-aws",label:"FTP",description:"OAuth token based"},{icon:"fas fa-aws",label:"Google Drive",description:"OAuth token based"},{icon:"fas fa-aws",label:"local",description:"The local filesystem"}],showHelp:!1,newAction:{action_name:null,label:null,action_schema:"",world_id:null,instance_optional:!1},showCreateActionDrawer:!1,showEditActionDrawer:!1,filter:null,localActions:[],columns:[{name:"name",field:"name",label:"action name",align:"left",sortable:!0}]},Object(s["d"])([]))},mounted:function(){this.refresh()},computed:f(f({filteredActions:function(){var t=this;return t.actions.filter((function(e){return!t.actionFilter||e.action_name.indexOf(t.actionFilter)>-1||e.ActionSchema.OnType.indexOf(t.actionFilter)>-1||e.ActionSchema.Label.indexOf(t.actionFilter)>-1}))}},Object(s["c"])(["actions","allTables"])),Object(s["d"])([])),watch:{}},b=u,w=n("2877"),m=n("09e3"),A=n("9989"),p=n("27f9"),g=n("9c40"),v=n("2bb1"),O=n("9404"),y=n("4983"),q=n("f09f"),_=n("a370"),C=n("0378"),S=n("4b7e"),E=n("eebe"),D=n.n(E),F=Object(w["a"])(b,a,i,!1,null,null,null);e["default"]=F.exports;D()(F,"components",{QPageContainer:m["a"],QPage:A["a"],QInput:p["a"],QBtn:g["a"],QMarkupTable:v["a"],QDrawer:O["a"],QScrollArea:y["a"],QCard:q["a"],QCardSection:_["a"],QForm:C["a"],QCardActions:S["a"]})}}]);