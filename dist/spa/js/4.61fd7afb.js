(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"5adf":function(e,t,o){"use strict";var a=o("7161"),n=o.n(a);n.a},7161:function(e,t,o){},de34:function(t,o,a){"use strict";a.r(o);var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("q-layout",[o("q-page-container",{staticStyle:{height:"100vh",overflow:"hidden"}},[o("q-dialog",{attrs:{persistent:""},model:{value:e.newNamePrompt,callback:function(t){e.newNamePrompt=t},expression:"newNamePrompt"}},[o("q-card",{staticStyle:{"min-width":"350px"}},[o("q-card-section",[o("div",{staticClass:"text-h6"},[e._v("Name")])]),o("q-card-section",{staticClass:"q-pt-none"},[o("q-input",{attrs:{dense:"",autofocus:""},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.createNew()}},model:{value:e.newName,callback:function(t){e.newName=t},expression:"newName"}})],1),o("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[o("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel"}}),o("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Create"},on:{click:function(t){return e.createNew()}}})],1)],1)],1),o("q-page",[o("div",{staticClass:"row",staticStyle:{height:"100vh","overflow-y":"scroll",background:"white"}},[o("div",{staticClass:"col-2 col-sm-12 col-md-2 col-lg-2 col-xl-2 col-xs-12"},[o("q-card",{staticStyle:{background:"white"},attrs:{flat:""}},[o("q-card-section",[o("q-btn",{staticStyle:{width:"100%",height:"38px"},attrs:{color:"primary",icon:"library_add",label:"Add workspace"},on:{click:function(t){e.showNewWorkspace=!0}}})],1),o("q-card-section",[o("q-tree",{attrs:{nodes:e.workspaceTree,accordion:"","no-connectors":"","node-key":"label",expanded:e.expanded},on:{"update:expanded":function(t){e.expanded=t}},scopedSlots:e._u([{key:"default-header",fn:function(t){return["root"===t.node.mime_type?o("div",{staticClass:"row items-center"},[o("div",{staticClass:"text-primary",staticStyle:{"font-weight":"400","text-transform":"uppercase"}},[e._v(e._s(t.node.label)+"\n                    ")])]):e._e(),"workspace/root"===t.node.mime_type?o("div",{staticClass:"workspace-title-container row ",on:{click:function(o){return e.openWorkspace(t.node)}}},[o("q-icon",{staticClass:"q-mr-sm",attrs:{name:"fas fa-briefcase",color:"primary",size:"14px"}}),o("div",{staticStyle:{"text-transform":"capitalize"}},[e._v(e._s(t.node.label)+"\n                    ")])],1):e._e()]}},{key:"default-body",fn:function(t){return[t.node.story?o("div",[o("span",{staticClass:"text-weight-bold"},[e._v("This node has a story")]),e._v(": "+e._s(t.node.story)+"\n                  ")]):e._e()]}}])})],1)],1)],1),o("div",{staticClass:"col-10 col-sm-12 col-md-10 col-lg-10 col-xl-10 col-xs-12",staticStyle:{background:"#F2F1F9"}},[e.showNewWorkspace||!e.currentWorkspace?o("new-workspace-screen",{on:{"new-workspace-created":e.refreshData}}):e._e(),!e.showNewWorkspace&&e.currentWorkspace?o("workspace-view",{attrs:{"workspace-name":e.currentWorkspace},on:{"delete-workspace":e.deleteWorkspace}}):e._e()],1)])]),o("user-header-bar",{staticStyle:{"border-bottom":"1px solid black"},attrs:{onBack:!1,buttons:{before:[],after:[]}},on:{search:e.searchDocuments,"show-uploader":e.showUploader}})],1)],1)},r=[],c=(a("8e6e"),a("8a81"),a("ac6a"),a("cadf"),a("456d"),a("7f7f"),a("551c"),a("06db"),a("28a5"),a("c47a")),s=a.n(c),i=(a("34ef"),a("2f62"));function l(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function u(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?l(Object(o),!0).forEach((function(t){s()(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):l(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var d={name:"WorkspaceBrowser",meta:function(){return{title:(this.currentWorkspace||"Home")+" - Workspace"}},watch:{currentPath:function(e){console.log("Current path changed",e),localStorage.setItem("_last_current_path",e)},"$route.params.currentWorkspace":function(e){console.log("Workspace changed",e)}},methods:u(u({openWorkspace:function(e){console.log("open workspace",e),this.$router.push("/workspace/"+e.label),this.currentWorkspace=e.label},searchDocuments:function(e){console.log("search documents",e),this.refreshData(e)},itemRename:function(e){console.log("rename item",e)},fileDblClicked:function(e){console.log("Item double click",e),e.is_dir?this.fileDownload(e):this.isEditable(e)?this.openEditor(e):this.isViewable(e)?this.openViewer(e):this.fileDownload(e)},isEditable:function(e){var t=["ddoc","dsheet"],o="";return e.document_name.indexOf(".")>-1&&(o=e.document_name.split(".")[1]),console.log("Check file extension",o),t.filter((function(e){return e===o})).length>0},isViewable:function(e){var t=["jpg","png","gif","txt","pdf","mp4","mp3","wav","mkv"],o="";return e.document_name.indexOf(".")>-1&&(o=e.document_name.split(".")[1]),t.filter((function(e){return e===o})).length>0},openEditor:function(e){var t=e.document_name.split(".")[1];switch(t){case"ddoc":return void this.$router.push("/apps/document/"+e.reference_id);case"dsheet":return void this.$router.push("/apps/spreadsheet/"+e.reference_id)}},openViewer:function(e){var t=e.document_name.split(".")[1];switch(t){case"ddoc":return void this.$router.push("/apps/document/"+e.reference_id);case"dsheet":return void this.$router.push("/apps/spreadsheet/"+e.reference_id)}},createNew:function(){console.log("Create ",this.newNameType,this.newName,this.currentPath);var e=this,t={document_name:this.newName,tableName:"document",document_extension:this.newName.indexOf(".")>-1?this.newName.split(".")[1]:"",mime_type:"",document_path:this.currentPath+"/",document_content:[{name:this.newName,type:"text/plain",path:this.currentPath,contents:"data:base64,"+btoa("")}]};"folder"===this.newNameType&&(t.document_extension="folder",t.document_content=[]),this.createRow(t).then((function(t){e.refreshData(),e.newNamePrompt=!1})).catch((function(t){console.log("Failed to create",t),e.$q.notify({message:JSON.stringify(t)})}))},deleteWorkspace:function(){this.currentWorkspace=null,this.refreshData()}},Object(i["b"])(["loadData","createRow","loadModel","deleteRow","setWorkspaceByName"])),{},{handleDataLoad:function(e){var t=this;null!==e.data?(console.log("Documents ",e),t.files=e.data.map((function(e){return e.icon="fas fa-folder",e.is_dir=!0,e.color="rgb(224, 135, 94)",e})),t.workspaceTree[0].children=t.files.map((function(e){return{label:e.document_name,icon:e.icon,mime_type:e.mime_type}})),t.workspaceTree[0].children.length>0&&(t.expanded.push(t.workspaceTree[0].children[0].label),this.currentWorkspace||t.$router.push("/workspace/"+t.workspaceTree[0].children[0].label))):t.$q.notify({message:"Error fetching files"})},refreshData:function(e){var t=this;t.showNewWorkspace=!1,t.selectedFile=null;var o={tableName:"document",params:{query:JSON.stringify([{column:"document_path",operator:"is",value:"/"},{column:"mime_type",operator:"like",value:"workspace/root"}]),page:{size:100}}};e&&e.trim().length>0&&(o.params.query=JSON.stringify([{column:"document_name",operator:"contains",value:e}])),t.files=[],console.log("Query data"),t.loadData(o).then((function(e){console.log("data load complete",t.currentWorkspace,e),!t.currentWorkspace&&e.data.length>0&&(t.currentWorkspace=e.data[0].document_name,t.$router.push("/workspace/"+t.currentWorkspace)),t.handleDataLoad(e)}))},ensureDirectory:function(e){var t=this;if("/"!==e&&!t.workspaceEnsureCache[e]){t.workspaceEnsureCache[e]=!0;var o=e.split("/"),a=o[o.length-1];o.pop();var n=o.join("/")+"/";console.log("Ensure directory",e);var r=[{column:"document_name",operator:"is",value:a},{column:"document_path",operator:"is",value:"/"},{column:"mime_type",operator:"is",value:"workspace/root"},{column:"document_extension",operator:"is",value:"folder"}];console.log("Document search query",r),t.loadData({tableName:"document",params:{query:JSON.stringify(r)}}).then((function(o){if(console.log("Ensure directory result",o),0===o.data.length){console.log("Directory does not exist",e);var r={document_name:a,tableName:"document",document_extension:"folder",mime_type:"workspace/root",document_path:n,document_content:[]};console.log("Create folder request",r),t.createRow(r).then((function(e){t.refreshData()})).catch((function(e){console.log("Failed to create folder",e),t.$q.notify({message:"Failed to create folder: "+JSON.stringify(e)})}))}}))}},uploadFile:function(t,o){var a=this;t.status="Queued";var n=function(n){return new Promise((function(r,c){var s=o||n.name,i=(n.type,new FileReader);t.status="Reading",i.onload=function(e){t.status="Uploading";var s=a.currentPath+"/";if(n.webkitRelativePath&&n.webkitRelativePath.length>0){var i=n.webkitRelativePath.split("/");i.pop(),s=a.currentPath+"/"+i.join("/")+"/"}var l=s.split("/");l.length>2&&(l.pop(),a.ensureDirectory(l.join("/")));var u={tableName:"document",document_content:[{name:o||n.name,contents:e.target.result,type:n.type,path:s}],document_name:o||n.name,document_path:s,mime_type:n.type,document_extension:n.name.indexOf(".")>-1?n.name.split(".")[1]:""};a.createRow(u).then((function(){t.status="Uploaded",a.refreshData(),r()})).catch(c)},i.onerror=function(){console.log("Failed to load file onerror",e,arguments),c(s)},i.readAsDataURL(n)}))};return n(t.file)},showUploader:function(){console.log("show uploader",this.showUploadComponent);var e=this;this.uploadedFiles=[],e.$refs.upload.$el.click()}}),data:function(){return u(u({searchInput:"",showNewWorkspace:!1,currentWorkspace:null},Object(i["c"])(["endpoint"])),{},{workspaceEnsureCache:{},newNamePrompt:!1,workspaceTree:[{label:"My Workspaces",children:[],mime_type:"root"},{label:"Shared workspaces",children:[],mime_type:"root"}],expanded:["My Workspaces"],viewMode:"card",uploadedFiles:[],newName:"",newNameType:"",currentPath:"",selectedFile:null,showSearchInput:!1,files:[],showUploadComponent:!1,viewParameters:{tableName:"document"},containerId:"id-"+(new Date).getMilliseconds(),screenWidth:(window.screen.width<1200?window.screen.width:1200)+"px"})},unmounted:function(){document.onpaste=null,document.ondrop=null},mounted:function(){var e=this;this.containerId="id-"+(new Date).getMilliseconds(),console.log("Mounted WorkspaceBrowser",this.containerId,this.$route.params),this.currentWorkspace=this.$route.params.workspaceName;var t=localStorage.getItem("_last_workspace");t&&!this.currentWorkspace&&(this.currentWorkspace=t),e.refreshData()}},p=d,m=(a("5adf"),a("2877")),h=a("4d5a"),f=a("09e3"),w=a("24e8"),k=a("f09f"),y=a("a370"),g=a("27f9"),v=a("4b7e"),b=a("9c40"),_=a("9989"),N=a("7f41"),x=a("0016"),W=a("7f67"),D=a("eebe"),O=a.n(D),C=Object(m["a"])(p,n,r,!1,null,null,null);o["default"]=C.exports;O()(C,"components",{QLayout:h["a"],QPageContainer:f["a"],QDialog:w["a"],QCard:k["a"],QCardSection:y["a"],QInput:g["a"],QCardActions:v["a"],QBtn:b["a"],QPage:_["a"],QTree:N["a"],QIcon:x["a"]}),O()(C,"directives",{ClosePopup:W["a"]})}}]);