(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{"3edf":function(e,o,t){"use strict";t.r(o);var n=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",[e.loaded?t("router-view",{on:{logout:function(o){return e.logout()}}}):e._e(),t("q-dialog",{attrs:{persistent:"",position:"bottom"},model:{value:e.showOfflineDialog,callback:function(o){e.showOfflineDialog=o},expression:"showOfflineDialog"}},[t("q-card",{staticStyle:{width:"350px"}},[t("q-linear-progress",{attrs:{value:1,color:"red"}}),t("q-card-section",{staticClass:"row items-center no-wrap"},[t("div",[t("div",{staticClass:"text-weight-bold"},[e._v("No server")]),t("div",{staticClass:"text-grey"},[e._v("We are offline")])]),t("q-space"),t("q-btn",{attrs:{color:"primary",label:"Go to server selector page",icon:"fast_forward"},on:{click:function(o){return e.$router.push("/backend")}}})],1)],1)],1)],1)},a=[],r=(t("8e6e"),t("8a81"),t("456d"),t("a34a")),i=t.n(r),l=(t("551c"),t("ac6a"),t("cadf"),t("06db"),t("5df3"),t("96cf"),t("c973")),c=t.n(l),s=t("9523"),d=t.n(s),u=t("2f62");function f(e,o){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);o&&(n=n.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),t.push.apply(t,n)}return t}function p(e){for(var o=1;o<arguments.length;o++){var t=null!=arguments[o]?arguments[o]:{};o%2?f(Object(t),!0).forEach((function(o){d()(e,o,t[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):f(Object(t)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))}))}return e}t("14b7");var h={name:"MainLayout",computed:{fileDrawerWidth:function(){return window.screen.availWidth}},components:{},data:function(){return p(p({showHelp:!1,showDrawerFull:!1,showOfflineDialog:!1,showAdminDrawerMini:!1,showAdminDrawerStick:!1},Object(u["c"])(["loggedIn","drawerLeft","authToken","decodedAuthToken","userGroupTable"])),{},{essentialLinks:[],drawer:!1,userDrawer:!0,loaded:!1,miniState:!0,isAdmin:!1,isUser:!1})},mounted:function(){var e=this;if(e.decodedAuthToken()){var o=e.decodedAuthToken(),t=1e3*o.exp<(new Date).getTime();if(console.log("Decoded auth token",t,o),t)return e.$q.notify({message:"Authentication has expired, please login again"}),e.setDecodedAuthToken(null),e.logout(),void this.$router.push("/login");e.loadModel(["cloud_store","user_account","usergroup","world","action","site","integration","calendar","document"]).then(c()(i.a.mark((function o(){return i.a.wrap((function(o){while(1)switch(o.prev=o.next){case 0:Promise.all([e.loadTable("world"),e.loadTable("document"),e.loadTable("usergroup")]).then((function(){console.log("Loaded world and document",arguments);var o=e.userGroupTable();console.log("Mounted main layout - ",o),2097057!==o.permission&&e.decodedAuthToken()&&(e.isAdmin=!0,e.executeAction({tableName:"world",actionName:"become_an_administrator"}).then((function(o){e.$q.notify({message:"You have become the administrator of this instance"}),e.loadTable("world")})).catch((function(e){console.log("Failed to become admin",e)}))),e.loaded=!0})).catch((function(e){console.log("Failed to load table ",e)})),e.getDefaultCloudStore(),e.loadData({tableName:"user_account"}).then((function(o){var t=o.data;console.log("Users: ",t),e.isUser=!0}));case 3:case"end":return o.stop()}}),o)})))).catch((function(o){e.showOfflineDialog=!0,console.log("Failed to load model for cloud store",o),e.$q.notify({message:"Failed to load model for cloud store"})}))}else this.$router.push("/login")},methods:p(p({},Object(u["b"])(["getDefaultCloudStore","loadModel","executeAction","loadData","setDecodedAuthToken","loadTable"])),{},{logout:function(){localStorage.removeItem("token"),localStorage.removeItem("user")}})},g=h,m=(t("ef68"),t("2877")),w=t("24e8"),b=t("f09f"),v=t("6b1d"),O=t("a370"),D=t("2c91"),y=t("9c40"),k=t("eebe"),T=t.n(k),j=Object(m["a"])(g,n,a,!1,null,null,null);o["default"]=j.exports;T()(j,"components",{QDialog:w["a"],QCard:b["a"],QLinearProgress:v["a"],QCardSection:O["a"],QSpace:D["a"],QBtn:y["a"]})},"62a7":function(e,o,t){},ef68:function(e,o,t){"use strict";var n=t("62a7"),a=t.n(n);a.a}}]);