(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[1],{"0557":function(e,t,a){"use strict";var o=a("1185"),n=a.n(o);n.a},10:function(e,t){},11:function(e,t){},1185:function(e,t,a){},12:function(e,t){},13:function(e,t){},14:function(e,t){},15:function(e,t){},16:function(e,t){},4:function(e,t){},5:function(e,t){},6:function(e,t){},7:function(e,t){},8:function(e,t){},9:function(e,t){},bf3a:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-layout",{staticClass:"user-area-pattern",attrs:{view:"lHh Lpr lFf"}},[a("q-page-container",[a("q-page",[a("div",{staticClass:"row",staticStyle:{width:"100vw",height:"40px"}},[a("q-btn",{staticClass:"text-primary tabMenuButton",attrs:{flat:"",id:"listTableButton",icon:"fas fa-bars"}},[a("q-menu",[a("q-list",{staticStyle:{"min-width":"280px"}},[e._l(e.baseConfig.items,(function(t){return a("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],key:t.document_name,attrs:{clickable:""},on:{click:function(a){return e.$router.push("/workspace/"+e.workspaceName+"/"+e.baseName+"/"+t.document_name)}}},[a("q-item-section",[e._v(e._s(t.document_name))]),a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:e.baseItemTypes[t.document_extension]?e.baseItemTypes[t.document_extension].icon:t.document_extension}})],1)],1)})),a("q-separator")],2)],1)],1),a("q-tabs",{staticClass:"text-black",staticStyle:{"max-width":"calc(100vw - 150px)",height:"40px"},attrs:{"inline-label":"",shrink:"","outside-arrows":""}},e._l(e.baseConfig.items,(function(t){return"summary"!==t.type?a("q-route-tab",{key:t.reference_id,staticStyle:{border:"1px solid black","border-radius":"4px"},attrs:{to:"/workspace/"+e.workspaceName+"/"+e.baseName+"/"+t.document_name,exact:"",replace:""}},[a("span",[a("q-icon",{attrs:{name:e.baseItemTypes[t.document_extension]?e.baseItemTypes[t.document_extension].icon:t.document_extension}}),e._v("    ")],1),e._v(e._s(t.document_name)+"\n              "),a("q-menu",{staticStyle:{"min-width":"300px"},attrs:{"context-menu":""}},[a("q-list",[a("q-item",{attrs:{clickable:""}},[a("q-item-section",{on:{click:function(a){return e.configureBaseItem(t)}}},[a("q-item-label",[e._v("Configure")])],1)],1),a("q-item",{attrs:{clickable:""},on:{click:function(a){return e.renameBaseItem(t)}}},[a("q-item-section",[a("q-item-label",[e._v("Rename")])],1)],1),a("q-item",{attrs:{clickable:""},on:{click:function(a){return e.deleteBaseItem(t)}}},[a("q-item-section",[a("q-item-label",[e._v("Delete")])],1)],1)],1)],1)],1):e._e()})),1),a("q-btn",{staticClass:"text-primary tabMenuButton",attrs:{flat:"",id:"newTableButton",icon:"fas fa-plus"}},[a("q-menu",[a("q-list",{staticStyle:{"min-width":"280px"}},[e._l(e.baseItemTypes,(function(t){return a("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],key:t.label,attrs:{disable:t.disabled,clickable:""},on:{click:function(a){return e.addBaseItem(t)}}},[a("q-item-section",[e._v(e._s(t.label))]),a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:t.icon}})],1)],1)})),a("q-separator")],2)],1)],1)],1),a("q-separator"),e.baseLoaded&&e.selectedBaseItem?a("base-view-router",{ref:"viewRouter",attrs:{"base-config":e.baseConfig,baseItem:e.selectedBaseItem}}):e._e()],1)],1),a("user-header-bar",{staticStyle:{"border-bottom":"1px solid black"},attrs:{buttons:{before:[],after:[{icon:"fas fa-sync-alt",event:"reload-bases"},{icon:"fas fa-trash",event:"delete-base"}]},onBack:function(){e.$router.push("/workspace/"+e.$route.params.workspaceName)},title:e.$route.params.workspaceName+"&nbsp;&nbsp; › &nbsp;&nbsp;"+e.$route.params.baseName+(e.$route.params.itemName?"&nbsp;&nbsp; › &nbsp;&nbsp;"+e.$route.params.itemName:"")},on:{"delete-base":e.deleteBase,search:e.searchDocuments,"reload-bases":e.refreshBaseData}}),a("q-dialog",{model:{value:e.confirmDeleteBaseMessage,callback:function(t){e.confirmDeleteBaseMessage=t},expression:"confirmDeleteBaseMessage"}},[a("q-card",{staticStyle:{background:"white"}},[a("q-card-section",[a("q-item",[a("q-item-label",[a("span",{staticClass:"text-h4"},[e._v("Delete")])])],1)],1),a("q-card-section",{staticClass:"q-pa-md"},[a("span",[e._v("Are you sure you want to delete all the items in this base ?")])]),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{staticClass:"float-right",attrs:{color:"negative",label:"Delete"},on:{click:function(t){return e.deleteBaseConfirm()}}})],1)],1)],1),a("q-dialog",{model:{value:e.showRenameBaseViewModel,callback:function(t){e.showRenameBaseViewModel=t},expression:"showRenameBaseViewModel"}},[a("q-card",{staticStyle:{background:"white","min-width":"400px"}},[a("q-card-section",[a("span",{staticClass:"text-h5"},[e._v("Rename item")])]),a("q-card-section",[a("q-input",{attrs:{id:"newBaseNameField"},model:{value:e.newName,callback:function(t){e.newName=t},expression:"newName"}})],1),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{attrs:{label:"Update",color:"primary"},on:{click:e.renameBaseItem}})],1)],1)],1),a("q-dialog",{model:{value:e.showDeleteConfirmDialog,callback:function(t){e.showDeleteConfirmDialog=t},expression:"showDeleteConfirmDialog"}},[a("q-card",{staticStyle:{background:"white"}},[a("q-card-section",[a("span",{staticClass:"text-h5"},[e._v("Delete")])]),a("q-card-section",[e._v("\n          Are you sure you want to delete this item\n        ")]),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{attrs:{label:"Delete",color:"negative"},on:{click:e.deleteBaseItem}})],1)],1)],1),a("q-drawer",{attrs:{overlay:"",width:450,side:"right"},model:{value:e.showBaseConfigurationModel,callback:function(t){e.showBaseConfigurationModel=t},expression:"showBaseConfigurationModel"}},[a("q-list",{staticClass:"q-pa-md"},[a("q-item",[a("q-item-section",[a("span",{staticClass:"text-bold"},[e._v("Configure")]),a("span",{staticClass:"text-h6"},[e._v(e._s(e.itemConfiguration.document_name))])])],1),a("q-item",[a("q-item-section",[a("div",{staticClass:"row"},[a("div",{staticClass:"col-12"},[a("span",{staticClass:"text-bold"},[e._v("Read access")])]),a("div",{staticClass:"col-12"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-12"},[a("q-checkbox",{attrs:{label:"Allow guests to see this item"},model:{value:e.itemConfiguration.allowGuests,callback:function(t){e.$set(e.itemConfiguration,"allowGuests",t)},expression:"itemConfiguration.allowGuests"}})],1)])])])])],1),a("q-item",[a("q-item-section",[a("div",{staticClass:"row"},[a("div",{staticClass:"col-12"},[a("q-btn",{staticClass:"float-right",attrs:{color:"primary",label:"Save"},on:{click:e.saveItemPermissions}})],1)])])],1)],1)],1)],1)},n=[],s=(a("8e6e"),a("8a81"),a("456d"),a("f559"),a("7f7f"),a("551c"),a("ac6a"),a("cadf"),a("06db"),a("5df3"),a("c47a")),i=a.n(s),l=a("2f62"),r=a("971a"),c=a("ec26");function m(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,o)}return a}function d(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?m(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function u(e){for(var t="",a="abcdefghijklmnopqrstuvwxyz",o=a.length,n=0;n<e;n++)t+=a.charAt(Math.floor(Math.random()*o));return t}window.XLSX=XLSX;var b={table:{attributes:{TableName:"New table",Columns:[{Name:"name",ColumnType:"label"}]}}},f={name:"BaseViewContainer",components:{BaseViewRouter:r["default"]},meta:function(){return{title:"["+this.$route.params.baseName+"] "+this.$route.params.itemName+" - "+this.$route.params.workspaceName}},methods:d(d({saveItemPermissions:function(){var e=this;this.showBaseConfigurationModel=!1,console.log("save config",this.itemConfiguration),this.itemConfiguration.allowGuests?e.updateRow({tableName:"document",id:this.itemBeingEdited.reference_id,permission:2097059}).then((function(t){e.$q.notify({message:"Updated permission for document"})})).catch((function(t){e.$q.notify({message:"Failed to update document permission: "+JSON.stringify(t.data)}),this.showBaseConfigurationModel=!0})):e.updateRow({tableName:"document",id:this.itemBeingEdited.reference_id,permission:2097025}).then((function(t){e.$q.notify({message:"Updated permission for document"})})).catch((function(t){e.$q.notify({message:"Failed to update document permission: "+JSON.stringify(t.data)}),this.showBaseConfigurationModel=!0}))},configureBaseItem:function(e){this.itemBeingEdited=e,this.showBaseConfigurationModel=!0,this.itemConfiguration={permission:e.permission,allowGuests:!1,document_name:e.document_name,usersWithWriteAccess:[],showOnFrontpage:!1}},deleteBaseItem:function(e){if(console.log("Delete base item",e,this.itemBeingEdited),!this.showDeleteConfirmDialog)return this.showDeleteConfirmDialog=!0,void(this.itemBeingEdited=e);this.showDeleteConfirmDialog=!1;var t=this;t.deleteRow({tableName:"document",reference_id:t.itemBeingEdited.reference_id}).then((function(e){t.$q.notify({message:"Item deleted"}),delete t.baseItemMap[t.itemBeingEdited.document_name];for(var a=-1,o=0;o<t.baseConfig.items.length;o++)if(t.baseConfig.items[o].document_name===t.itemBeingEdited.document_name){a=o;break}if(console.log("Item to remove from base config",a),a>-1){var n=t.baseConfig.items[a];"table"===n.type&&(console.log("target table details,",n),t.deleteTableByName(n.targetTable.TableName)),t.baseConfig.items.splice(a,1)}}))},renameBaseItem:function(e){var t=this;if(console.log("Rename base item",this.itemBeingEdited),!0!==this.showRenameBaseViewModel)return this.itemBeingEdited=e,this.newName=this.itemBeingEdited.document_name,this.showRenameBaseViewModel=!0,void t.$nextTick().then((function(){}));if(console.log("Updated name",this.newName),this.newName!==this.itemBeingEdited.document_name){console.log("Update item");var a=this.itemBeingEdited.document_name;this.itemBeingEdited.document_name=this.newName,t.updateRow({tableName:"document",id:t.itemBeingEdited.reference_id,document_name:t.newName}).then((function(e){console.log("Updated item name",e),t.baseItemMap[t.newName]=t.baseItemMap[a],delete t.baseItemMap[a],a===t.selectedItem&&t.$router.push("/workspace/"+t.workspaceName+"/"+t.baseName+"/"+t.newName)})).catch((function(e){console.log("Failed to update item name",e)}))}this.showRenameBaseViewModel=!1},addBaseItem:function(e){var t=this;console.log("Add new item to base",e);var a="New "+e.type+" - "+Math.floor(90*Math.random()+10),o={type:e.type,label:a};b[e.type]&&(o=b[e.type],o.document_extension=e.type,o.document_name=a);var n=null;n={document_name:a,tableName:"document",document_extension:e.type,mime_type:"workspace/"+e.type,document_path:"/"+t.workspaceName+"/"+t.baseName,document_content:[{name:e.type+"-"+Object(c["a"])()+".json",type:"workspace/"+e.type,path:"/"+t.workspaceName+"/"+t.baseName,contents:"workspace/"+e.type+","+btoa(JSON.stringify(o))}]},console.log("Create base request",n),t.createRow(n).then((function(e){console.log("New workspace item created",e),o.reference_id=e.data.reference_id;var a=d(d({},o),e.data);t.baseConfig.items.push(a),t.baseItemMap[o.label]=a,t.ensureBaseTables(),t.selectedBaseItem=a,t.$nextTick().then((function(){t.$refs.viewRouter.reloadBaseItem(),t.renameBaseItem(a)}))})).catch((function(e){console.log("Failed to create new item",e),t.$q.notify({message:"Failed to create new item - "+JSON.stringify(e)})}))},deleteBaseConfirm:function(){console.log("Delete base",this.baseName);var e=this;e.confirmDeleteBaseMessage=!1,e.loadData({tableName:"document",params:{query:JSON.stringify([{column:"document_path",operator:"is",value:"/"+e.workspaceName+"/"+e.baseName}]),page:{size:100}}}).then((function(t){console.log("base items to be deleted",t);for(var a=[],o=0;o<t.data.length;o++){var n=t.data[o];console.log("Delete item",n),a.push(e.deleteRow({tableName:"document",reference_id:n.id}))}if(e.baseConfig.items)for(o=0;o<e.baseConfig.items.length;o++){n=e.baseConfig.items[o];"table"===n.type&&(console.log("target table details,",n),e.deleteTableByName(n.targetTable.TableName))}Promise.all(a).then((function(t){console.log("All child item deleted",t,"delete base",e.baseRow),e.deleteRow({tableName:"document",reference_id:e.baseRow.id}).then((function(t){console.log("Base deleted"),e.$router.push("/workspace/"+e.workspaceName)})).catch((function(t){console.log("Failed to delete base",t),e.$q.notify({message:"Failed to delete base please try again later"})}))})).catch((function(e){console.log("Failed to delete a child item",e)}))}))},deleteBase:function(){console.log("Delete base",this.baseName);var e=this;e.confirmDeleteBaseMessage=!0},searchDocuments:function(e){console.log("search data",arguments),this.searchQuery=e,this.refreshData()},showUploadData:function(){}},Object(l["b"])(["loadData","getTableSchema","updateRow","createRow","deleteRow","executeAction","loadModel","deleteTableByName"])),{},{refreshBaseData:function(){var e=this;return e.baseItemMap={},new Promise((function(t,a){var o=e.$route.params.workspaceName,n=e.$route.params.baseName;e.selectedItem=e.$route.params.itemName,e.baseName=n,e.baseConfig={name:n},e.workspaceName=o,e.$q.notify({message:"Refreshing base"});var s={tableName:"document",params:{query:JSON.stringify([{column:"document_path",operator:"is",value:"/"+o},{column:"mime_type",operator:"is",value:"workspace/base"},{column:"document_name",operator:"is",value:n}]),page:{size:1},included_relations:"document_content"}};e.files=[],console.log("Query base content document"),e.loadData(s).then((function(i){console.log("loaded base document",i);var l=i.data[0];if(l.document_content){e.baseRow=l;var r=l.document_content[0].contents;e.baseConfig=JSON.parse(atob(r)),e.baseConfig.name=e.baseName,console.log("selected base item 1",e.selectedItem,e.baseConfig,e.baseItemMap,e.selectedBaseItem),s={tableName:"document",params:{query:JSON.stringify([{column:"document_path",operator:"is",value:"/"+o+"/"+n},{column:"mime_type",operator:"like",value:"workspace/%"}]),page:{size:100},included_relations:"document_content"}},e.baseConfig.items=[],e.loadData(s).then((function(o){console.log("loaded base item documents",o);for(var n=0;n<o.data.length;n++)try{var s=o.data[n],i=JSON.parse(atob(s.document_content[0].contents));s=d(d({},s),i),e.baseItemMap[s.document_name]=s,e.baseConfig.items.push(s)}catch(l){console.log("failed to parse item data",l)}e.selectedBaseItem=e.baseItemMap[e.selectedItem],e.ensureBaseTables().then((function(){t()})).catch(a)}))}else alert("Base configuration is empty - "+l)}))}))},ensureBaseTables:function(){var e=this;console.log("Ensure base tables",this.baseConfig);for(var t=[],a={Tables:[]},o=0;o<e.baseConfig.items.length;o++){var n=e.baseConfig.items[o];if("table"===n.type){console.log("Table item",n,n.targetTable);var s=n.targetTable;if(!s){var i=n.attributes;i||(console.log("No columns defined for table: ",n),i={Columns:[]}),i.TableName="tab_"+u(7);for(var l=0;l<i.Columns.length;l++){var r=i.Columns[l];r.ColumnType.startsWith("file.")&&(r.DataType="blob",r.IsForeignKey=!0,r.ForeignKeyData={DataSource:"cloud_store",Namespace:"localstore",KeyName:r.ColumnName})}console.log("No target table exists for this item, creating one",n.document_name,i.TableName),a.Tables.push(i),n.targetTable=i,e.baseItemMap[n.document_name].document_content[0].contents=btoa(JSON.stringify(n)),console.log("Update base request",e.baseItemMap[n.document_name]),e.baseItemMap[n.document_name].tableName="document",t.push(e.updateRow(e.baseItemMap[n.document_name]))}}}return new Promise((function(o,n){Promise.all(t).then((function(){a.Tables.length>0?(e.$q.loadingBar.start(),e.$q.notify({message:"Creating "+a.Tables.length+" tables"}),e.executeAction({tableName:"world",actionName:"upload_system_schema",params:{schema_file:[{contents:"application/json,"+btoa(JSON.stringify(a)),name:e.baseName+".json"}]}}).then((function(t){e.$q.loadingBar.stop(),console.log("Tables created",t),e.$q.notify({message:"Base tables created, please wait while we generate random data to begin"}),console.log("Try to create random data for the new base"),e.$q.notify({message:"Generating random data for "+a.Tables.length+" tables"}),e.$q.loadingBar.start();var n=[];n=a.Tables.map((function(t){return console.log("Create random data for ",t.TableName),new Promise((function(a,o){var n=function o(){setTimeout((function(){e.executeAction({tableName:"world",actionName:"generate_random_data",params:{table_name:t.TableName,count:10}}).then((function(n){if(console.log("Generate random data response",n),!n||""===n)return console.log("data generate failed, try again",n),e.$q.loadingBar.increment(5),void o();e.$q.loadingBar.increment(5),console.log("Random data generated for table",t.TableName),a()})).catch((function(e){o(),console.log("Failed to generate random data for ",t.TableName,e)}))}),5e3)};n()}))})),Promise.all(n).then((function(){e.$q.loadingBar.stop(),o()})).catch((function(e){console.log("Failed to create random data",e)}))})).catch((function(t){console.log("Failed to create table",t),e.$q.notify({message:"Failed to create tables for the base"}),n()}))):o()}))}))},refreshData:function(){var e=this;return e.newRowData=[],e.sourceMap={},console.log("Refresh data, update the selected item",e.selectedItem,e.baseItemMap),console.log("Updated base ",e.selectedItem,e.baseName,e.selectedBaseItem),e.selectedItem=e.$route.params.itemName,e.baseName=e.$route.params.baseName,e.selectedBaseItem=e.baseItemMap[e.selectedItem],e.baseLoaded=!0,Promise.resolve()}}),props:["baseConfiguration"],data:function(){return{showBaseConfigurationModel:!1,baseItemMap:{},itemConfiguration:{},showRenameBaseViewModel:!1,showDeleteConfirmDialog:!1,itemBeingEdited:null,newName:null,baseLoaded:!1,dataUploadFile:null,selectedBaseItem:null,itemIconMap:{table:"fas fa-table",view:"fas fa-eye",spreadsheet:"table_view",document:"fas fa-file-alt",folder:"folder_open",calendar:"calendar_today",mailbox:"all_inbox"},baseRow:null,confirmDeleteBaseMessage:!1,searchQuery:null,baseConfig:{items:[]},workspaceDocument:null,selectedItem:null,workspaceName:null,baseName:null,itemName:null,tablePermissionDrawer:!1,currentPage:1,tabulatorOptions:{headerFilter:!1},currentPagination:{},defaultColumns:["updated_at","created_at","reference_id","permission"],tableSchema:{ColumnModel:[]},rows:[],tableData:null,newRowDrawer:!1,newRowData:[],selectedRows:[]}},computed:d({},Object(l["c"])(["endpoint","authToken","tables","baseItemTypes"])),updated:function(){},mounted:function(){var e=this;this.refreshBaseData().then((function(){console.log("base load complete return"),e.refreshData()})).catch((function(e){console.log("Failed to complete base data refresh",e)}))},watch:{"$route.params.baseName":function(){console.log("base name changed",arguments),this.refreshData()},"$route.params.itemName":function(){console.log("item name changed",arguments),this.refreshData()}}},p=f,g=(a("0557"),a("2877")),h=a("4d5a"),w=a("09e3"),y=a("9989"),v=a("9c40"),N=a("4e73"),_=a("1c1c"),q=a("66e5"),C=a("4074"),B=a("0016"),k=a("eb85"),I=a("429b"),D=a("7867"),x=a("0170"),M=a("24e8"),T=a("f09f"),$=a("a370"),R=a("4b7e"),O=a("27f9"),S=a("9404"),Q=a("8f8e"),P=a("7460"),E=a("7f67"),F=a("eebe"),j=a.n(F),J=Object(g["a"])(p,o,n,!1,null,"5777f771",null);t["default"]=J.exports;j()(J,"components",{QLayout:h["a"],QPageContainer:w["a"],QPage:y["a"],QBtn:v["a"],QMenu:N["a"],QList:_["a"],QItem:q["a"],QItemSection:C["a"],QIcon:B["a"],QSeparator:k["a"],QTabs:I["a"],QRouteTab:D["a"],QItemLabel:x["a"],QDialog:M["a"],QCard:T["a"],QCardSection:$["a"],QCardActions:R["a"],QInput:O["a"],QDrawer:S["a"],QCheckbox:Q["a"],QTab:P["a"]}),j()(J,"directives",{ClosePopup:E["a"]})}}]);